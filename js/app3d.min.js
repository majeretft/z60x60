var App=function(){this._fovMin=25;this._fovMax=50;this.orbits=[];this.modelName=App.getQueryStringParam("obj")};App.getGLState=function(){try{var n=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(n.getContext("webgl")||n.getContext("experimental-webgl")))}catch(t){return!1}};App.getQueryStringParam=function(n){if(!n)return null;var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t==null?"":decodeURIComponent(t[1].replace(/\+/g," "))};App.prototype={constructor:App,buildScene:function(){function c(n){if(n.touches&&n.touches.length==2){var t=n.touches[0].pageX-n.touches[1].pageX,i=n.touches[0].pageY-n.touches[1].pageY,r=Math.sqrt(t*t+i*i);u.set(0,r)}}function l(t){if(t.touches&&t.touches.length==2){t.preventDefault?t.preventDefault():t.returnValue=!1;t.stopPropagation&&t.stopPropagation();var i=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,o=Math.sqrt(i*i+r*r);f.set(0,o);e.subVectors(f,u);e.y>0?n.changeFov(-1):e.y<0&&n.changeFov(1);u.copy(f)}}var n,i,s,t,r,h,o;if(this.modelName){n=this;i=$("#scene")[0];this.renderer=new THREE.WebGLRenderer({alpha:!0,canvas:i,antialias:!0});+window.devicePixelRatio>1&&this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setSize(window.innerWidth,window.innerHeight);this.camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,4e3);s=new THREE.AmbientLight(5592405);t=new THREE.PointLight(16777215);t.intensity=.9;this.scene=new THREE.Scene;this.scene.add(t);this.scene.add(s);this.camera.lookAt(this.scene.position);this.camera.position.set(50,30,50);t.position.set(50,50,50);this.orbits.push(new THREE.OrbitControls(this.camera,i));this.orbits.push(new THREE.OrbitControls(t,i));r=function(t){var r=t.deltaY||t.wheelDelta||t.detail,i;t.preventDefault?t.preventDefault():t.returnValue=!1;t.stopPropagation&&t.stopPropagation();i=r*.05;n.changeFov(i)};"onwheel"in document?document.addEventListener("wheel",r,!1):"onmousewheel"in document?document.addEventListener("mousewheel",r,!1):document.addEventListener("MozMousePixelScroll",r,!1);var u=new THREE.Vector2,f=new THREE.Vector2,e=new THREE.Vector2;this.renderer.domElement.addEventListener("touchstart",c,!1);this.renderer.domElement.addEventListener("touchmove",l,!1);h=new THREE.OBJMTLLoader;o="obj3d/";h.load(o+this.modelName+".obj",o+this.modelName+".mtl",function(t){t.scale.set(.6,.6,.6);t.position.y=-10;n.scene.add(t);n.obj3d=t})}},changeFov:function(n){var t=this.camera.fov+n;t<this._fovMin||t>this._fovMax||(this.camera.fov=t,this.camera.updateProjectionMatrix())},changeColor:function(n){var t,i;this.obj3d&&this.oldColor!=n&&(t=this.obj3d.children[2],t&&t.material)&&(i=n.substring(1),t.material.color=new THREE.Color(parseInt(i,16)),this.oldColor=n)}};$(function(){var n=new App;n.buildScene();$(window).resize(function(){+window.devicePixelRatio>1&&n.renderer.setPixelRatio(window.devicePixelRatio);n.renderer.setSize(window.innerWidth,window.innerHeight);n.camera.aspect=window.innerWidth/window.innerHeight;n.camera.updateProjectionMatrix()});var t={matColor:viewCfg.matColor,camPos:n.camera.position.clone(),camFov:n.camera.fov},i=!0,u=function(){if(viewCfg.autorotate)for(var r=0;r<n.orbits.length;r++)n.orbits[r].update();(t.matColor!=viewCfg.matColor||!t.camPos.equals(n.camera.position)||t.camFov!=n.camera.fov||i)&&(t.matColor=viewCfg.matColor,t.camPos=n.camera.position.clone(),t.camFov=n.camera.fov,i=!1,viewCfg.matColor&&n.changeColor(viewCfg.matColor),n.renderer.render(n.scene,n.camera))},r=function(){requestAnimationFrame(r);u()};r()});