THREE.MTLLoader=function(n){this.manager=n!==undefined?n:THREE.DefaultLoadingManager};THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(n,t,i,r){var f=this,u=new THREE.XHRLoader(this.manager);u.setCrossOrigin(this.crossOrigin);u.load(n,function(n){t(f.parse(n))},i,r)},setBaseUrl:function(n){this.baseUrl=n},setCrossOrigin:function(n){this.crossOrigin=n},setMaterialOptions:function(n){this.materialOptions=n},parse:function(n){for(var i,f,t,r,o,e,h=n.split("\n"),u={},c=/\s+/,l={},s=0;s<h.length;s++)(i=h[s],i=i.trim(),i.length!==0&&i.charAt(0)!=="#")&&(f=i.indexOf(" "),t=f>=0?i.substring(0,f):i,t=t.toLowerCase(),r=f>=0?i.substring(f+1):"",r=r.trim(),t==="newmtl"?(u={name:r},l[r]=u):u&&(t==="ka"||t==="kd"||t==="ks"||t==="ke"?(o=r.split(c,3),u[t]=[parseFloat(o[0]),parseFloat(o[1]),parseFloat(o[2])]):u[t]=t==="map_ka"||t==="map_kd"||t==="map_ks"||t==="map_ns"||t==="map_d"||t==="decal"||t==="bump"||t==="map_bump"?this.parseMap(r,c):r));return e=new THREE.MTLLoader.MaterialCreator(this.baseUrl,this.materialOptions),e.setCrossOrigin(this.crossOrigin),e.setManager(this.manager),e.setMaterials(l),e},parseMap:function(n,t){if(n==null)return null;var o=/(?:\x2Dblendu\s+)on/i.test(n),s=/(?:\x2Dblendv\s+)on/i.test(n),h=/(?:\x2Dcc\s+)on/i.test(n),c=/(?:\x2Dclamp\s+)on/i.test(n),i=/\x2Do\s([\x2D\d\x2E\s]+)/i.exec(n),r=/\x2Ds\s([\x2D\d\x2E\s]+)/i.exec(n),u=/\x2Dt\s([\x2D\d\x2E\s]+)/i.exec(n),f=/\x2Dtexres\s(\d+)/i.exec(n),e=/(?:\s|^)([\w\x2D\x2E]*)$/.exec(n);return i&&i[1]!=null&&(i[1]=i[1].replace(/\s\x2D$/,"")),r&&r[1]!=null&&(r[1]=r[1].replace(/\s\x2D$/,"")),u&&u[1]!=null&&(u[1]=u[1].replace(/\s\x2D$/,"")),{blendu:o,blendv:s,cc:h,clamp:c,o:i&&i[1]!=null?i[1].split(t,3):null,s:r&&r[1]!=null?r[1].split(t,3):null,t:u&&u[1]!=null?u[1].split(t,3):null,texres:f&&f[1]!=null?Number(f[1]):null,tex:e?e[1]:null}}};THREE.MTLLoader.MaterialCreator=function(n,t){this.baseUrl=n;this.options=t;this.materialsInfo={};this.materials={};this.materialsArray=[];this.nameLookup={};this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide;this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping};THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,setCrossOrigin:function(n){this.crossOrigin=n},setManager:function(n){this.manager=n},setMaterials:function(n){this.materialsInfo=this.convert(n);this.materials={};this.materialsArray=[];this.nameLookup={}},convert:function(n){var i,r,u,f,e;if(!this.options)return n;i={};for(r in n){u=n[r];f={};i[r]=f;for(e in u){var o=!0,t=u[e],s=e.toLowerCase();switch(s){case"kd":case"ka":case"ks":case"ke":this.options&&this.options.normalizeRGB&&(t=[t[0]/255,t[1]/255,t[2]/255]);this.options&&this.options.ignoreZeroRGBs&&t[0]===0&&t[1]===0&&t[1]===0&&(o=!1);break;case"d":this.options&&this.options.invertTransparency&&(t=1-t)}o&&(f[s]=t)}}return i},preload:function(){for(var n in this.materialsInfo)this.create(n)},getIndex:function(n){return this.nameLookup[n]},getAsArray:function(){var n=0;for(var t in this.materialsInfo)this.materialsArray[n]=this.create(t),this.nameLookup[t]=n,n++;return this.materialsArray},create:function(n){return this.materials[n]===undefined&&this.createMaterial_(n),this.materials[n]},createMaterial_:function(n){var e=this.materialsInfo[n],t={name:n,side:this.side},f,i,r,u;for(f in e){i=e[f];switch(f.toLowerCase()){case"kd":t.color=(new THREE.Color).fromArray(i);break;case"ks":t.specular=(new THREE.Color).fromArray(i);break;case"ke":t.emissive=(new THREE.Color).fromArray(i);break;case"map_kd":t.map=this.loadTexture(this.baseUrl+i.tex);t.map.wrapS=this.wrap;t.map.wrapT=this.wrap;i.s&&(r=i.s[0]||1,u=i.s[1]||1,t.map.repeat=new THREE.Vector2(r,u));break;case"ns":t.shininess=parseFloat(i);break;case"d":i<1&&(t.transparent=!0,t.opacity=i);break;case"map_bump":case"bump":if(t.bumpMap)break;t.bumpMap=this.loadTexture(this.baseUrl+i.tex);t.bumpMap.wrapS=this.wrap;t.bumpMap.wrapT=this.wrap;i.s&&(r=i.s[0]||1,u=i.s[1]||1,t.bumpMap.repeat=new THREE.Vector2(r,u))}}return this.materials[n]=new THREE.MeshPhongMaterial(t),this.materials[n]},loadTexture:function(n,t,i,r,u){var f,e=THREE.Loader.Handlers.get(n),o=this.manager!==undefined?this.manager:THREE.DefaultLoadingManager;return e!==null?f=e.load(n,i):(f=new THREE.Texture,e=new THREE.ImageLoader(o),e.setCrossOrigin(this.crossOrigin),e.load(n,function(n){f.image=THREE.MTLLoader.ensurePowerOfTwo_(n);f.needsUpdate=!0;i&&i(f)},r,u)),t!==undefined&&(f.mapping=t),f}};THREE.MTLLoader.ensurePowerOfTwo_=function(n){var t,i;return!THREE.Math.isPowerOfTwo(n.width)||!THREE.Math.isPowerOfTwo(n.height)?(t=document.createElement("canvas"),t.width=THREE.MTLLoader.nextHighestPowerOfTwo_(n.width),t.height=THREE.MTLLoader.nextHighestPowerOfTwo_(n.height),i=t.getContext("2d"),i.drawImage(n,0,0,n.width,n.height,0,0,t.width,t.height),t):n};THREE.MTLLoader.nextHighestPowerOfTwo_=function(n){--n;for(var t=1;t<32;t<<=1)n=n|n>>t;return n+1};THREE.EventDispatcher.prototype.apply(THREE.MTLLoader.prototype);